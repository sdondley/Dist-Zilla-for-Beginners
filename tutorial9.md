# Testing Tutorial Part I: `[@Starter]` Bundle Tests

Right up there with `use strict` and `use warnings` is the admonition to "test
your code!" We will spare nagging you with all the excellent reasons why you
should write tests for your code.

The testing tutorial is split into two parts. The first will provide a basic
overview of testing and go into some detail on the test plugins supplied by the
`[@Starter]` bundle. The second part is more hands-on and we'll get our feet wet
adding some basic tests and showing you how to leverage `Dist::Zilla`, its
commands and provide a few pointers for writing good quality code with tests.

If you are new to module development, you may not be all that familiar with the
process of writing and running tests. But don't get scared off. This tutorial is
designed to provide a gentle introduction for building tests into your
distribution. All you need to understand right now is that a test file is
nothing but a perl script with functions inside of it that tell us if our module
is module is working as expected. Hopefully, after reading this tutorial, you'll
have enough confidence to begin writing tests for your code and/or get motivated
to learn more about testing from other very fine learning materials.

If you are a developer that already tests your code, the tutorial will teach you
the basics on how to use `Dist::Zilla` to run tests and introduce your to useful
plugins related to testing. You might also learn about some testing tools and
strategies you may not be using presently.

## Tests Supplied with the `[@Starter]` Bundle

So let's introduce the testing plugins supplied with the `[@Starter]` bundle.
The `[@Starter]` bundle's plugins generate two different types of tests for us:
**standard tests** and **author tests.**

### Standard Tests

Standard tests are found in our distribution's `t` ("t" for "tests") directory.
These tests are run frequently by developers to make sure they aren't
introducing new bugs into their code as the module is developed. Standard tests
should also be run on the developer's machine just prior to shipping the
distribution to end users.

End user's should run the standard tests before installing the software. When
run by end users, standard tests ensure that the module will still work properly
even if it isn't running on the exact same hardware and software configuration
as the the developer's. As much as possible, these tests are automted without
the user having to do anything explicity to run them. However, end users will
have a chance to skip them if they really want to.

### Author Tests

Author tests, on the other hand, are intended to be run by developers but not by
end users. `Dist::Zilla` places the author tests generated by the in the
`[@Starter]` bundle plugins in the `xt/author` ("x" for "extra" or "extended")
directory. Author tests usually aren't run quite as freqently as standard tests
but are usually run just before a distribution is released to end users.

### Running Our Tests Manually

Our `[@Starter]` bundle plugins take care of running appropriate tests for us
automatically when building and releasing the distribution. But we can trigger
the execution of all standard and author tests at any time by running:

`dzil test`

### Examining Our Test Output

After running `dzil test`, and if you did the earlier tutorials properly, you
should see output similar to the following with an `All's well` message from
`Dist::Zilla` at the very end:

```

[DZ] building distribution under .build/S4KqMi5K5i for installation
[DZ] beginning to build sayhi
[DZ] guessing dist's main_module is lib/sayhi.pm
[DZ] writing sayhi in .build/S4KqMi5K5i
[ReadmeAnyFromPod] overriding README.mkdn in root
Checking if your kit is complete...
Looks good
Generating a Unix-style Makefile
Writing Makefile for sayhi
Writing MYMETA.yml and MYMETA.json
cp lib/sayhi.pm blib/lib/sayhi.pm
cp bin/the_command blib/script/the_command
"/usr/bin/perl" -MExtUtils::MY -e 'MY->fixin(shift)' -- blib/script/the_command
PERL_DL_NONLAZY=1 "/usr/bin/perl" "-MExtUtils::Command::MM" "-MTest::Harness" "-e" "undef *Test::Harness::Switches; test_harness(0, 'blib/lib', 'blib/arch')" t/*.t
t/00-report-prereqs.t .. #
# Versions for all modules listed in MYMETA.json (including optional ones):
#
# === Configure Requires ===
#
#     Module              Want Have
#     ------------------- ---- ----
#     ExtUtils::MakeMaker  any 7.34
#
# === Build Requires ===
#
#     Module              Want Have
#     ------------------- ---- ----
#     ExtUtils::MakeMaker  any 7.34
#
# === Test Requires ===
#
#     Module              Want     Have
#     ------------------- ---- --------
#     ExtUtils::MakeMaker  any     7.34
#     File::Spec           any  3.48_01
#     Test::More           any 1.302136
#
# === Test Recommends ===
#
#     Module         Want     Have
#     ---------- -------- --------
#     CPAN::Meta 2.120900 2.143240
#
# === Develop Requires ===
#
#     Module     Want     Have
#     ---------- ---- --------
#     File::Spec  any  3.48_01
#     IO::Handle  any     1.35
#     IPC::Open3  any     1.16
#     Test::More  any 1.302136
#     Test::Pod  1.41     1.51
#
t/00-report-prereqs.t .. ok
All tests successful.
Files=1, Tests=1,  0 wallclock secs ( 0.01 usr  0.01 sys +  0.13 cusr  0.00 csys =  0.15 CPU)
Result: PASS
xt/author/00-compile.t .. ok
xt/author/pod-syntax.t .. ok
All tests successful.
Files=2, Tests=5,  0 wallclock secs ( 0.02 usr  0.01 sys +  0.15 cusr  0.02 csys =  0.20 CPU)
Result: PASS
[DZ] all's well; removing .build/S4KqMi5K5i

```

If you see one or more errors instead, double check that you are at the top
level of the the work area (source tree) and not in the distribution (build
tree). You may also not have the `Greetings` module properly installed from the
earlier tutorial. You could also have a badly configured Perlbrew installation
or similar misconfiguration while trying to run multiple versions of Perl on
your machine. Or you may have made an error while following along with the
tutorials. Whatever the case, you should try to resolve these issues before
proceeding.

So what are we looking at, exactly, and how do we make sense of it? At the
highest level, you are seeing the output from a chain of tools which work
together to run the tests located in the `t` and `xt` directories in your
disribution. The output is a mix of information generated by four different
levels of software:

1) `Dist::Zilla` which...
2) executes the `Makefile.PL` build script which...
3) loads the tests into the `Test::Harness` module which...
4) executes the tests themselves.

The `Test::Harness` output is the most important as it reports back which tests
passed and which ones failed along with any errors accompanying the failed tests.

### The Prerequisites Standard Test

Most of the other output, the stuff in the middle in a tabular layout, is a
listing of the various requirements for installing, testing, configuring and
running your module, also known as prerequisites. This report is generated by
the test created by the `[Test::ReportPrereqs]` plugin that comes with the
`[@Starter]` bundle. You can see the actual code for the test in the
`sayhi-0.001/t/00-report-prereqs.t` file. Yes, it's a hairy and scary looking
piece of code but all you need to know is that it tests whether or not the
computer supplies the minimum required software your module needs and reports
any issues if there are any. The other file in the `t` directory,
`00-report-prereqs.dd` is not a test but a helper file for the
`00-report-prereqs.t` test file.

### The Author Tests

There are two other test files automatically generated by the `[@Starter]`
bundle. They are both author tests and so can be found in the `xt/author`
directory in the distribution. The output generated from running the
five tests between the two author test files is much more succinct:

```

xt/author/00-compile.t .. ok
xt/author/pod-syntax.t .. ok
All tests successful.
Files=2, Tests=5,  0 wallclock secs ( 0.02 usr  0.01 sys +  0.15 cusr  0.02 csys =  0.20 CPU)
Result: PASS

```

We can see the file names containing our test files in the first two lines. The
first test file is generated by `[Test::Compile]` plugin and the second by the
`[PodSyntaxTests]`. It's interesting to note that the `[@Starter]` bundle
passes an `xt_mode = 1` parameter to the `[Test::Compile]` plugin which tells
`Dist::Zilla` to treat it like an author test instad of a standard test.

So what do these two author tests do?

#### The Compile Test

The tests in `00-compile.t` ensure that our perl code won't throw any errors
when compiled by the perl interpreter, at least the code that depends on core
perl modules. In other words, it acts as a syntax checker and will report
any errors if parts of your code fail to compile.

#### The POD Syntax Test

The tests in `pod-syntax.t` will inspect your pod documenation and report any
syntax issues it finds.
